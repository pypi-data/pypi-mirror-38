- job:
    name: octavia-dsvm-base
    parent: devstack-tempest
    timeout: 7800
    required-projects:
      - openstack/octavia
      - openstack/octavia-tempest-plugin
      - openstack/python-octaviaclient
    pre-run: playbooks/Octavia-DSVM/pre.yaml
    irrelevant-files:
      - ^.*\.rst$
      - ^api-ref/.*$
      - ^doc/.*$
      - ^etc/.*$
      - ^releasenotes/.*$
    vars:
      devstack_localrc:
        TEMPEST_PLUGINS: "'/opt/stack/octavia-tempest-plugin'"
      devstack_local_conf:
        post-config:
          $OCTAVIA_CONF:
            DEFAULT:
              debug: True
      devstack_services:
        c-bak: false
        ceilometer-acentral: false
        ceilometer-acompute: false
        ceilometer-alarm-evaluator: false
        ceilometer-alarm-notifier: false
        ceilometer-anotification: false
        ceilometer-api: false
        ceilometer-collector: false
        c-sch: false
        c-api: false
        c-vol: false
        cinder: false
        octavia: true
        o-api: true
        o-cw: true
        o-hm: true
        o-hk: true
        swift: false
        s-account: false
        s-container: false
        s-object: false
        s-proxy: false
        tempest: true
      devstack_plugins:
        octavia: https://github.com/openstack/octavia.git

- job:
    name: octavia-dsvm-live-base
    parent: octavia-dsvm-base
    timeout: 9000
    required-projects:
      - openstack/barbican
      - openstack/diskimage-builder
      - openstack/python-barbicanclient
    vars:
      devstack_localrc:
        DIB_LOCAL_ELEMENTS: openstack-ci-mirrors
      devstack_services:
        barbican: true
        neutron-qos: true
      devstack_plugins:
        barbican: https://github.com/openstack/barbican.git
        neutron: https://github.com/openstack/neutron.git
      zuul_copy_output:
        '/var/log/dib-build' : logs

- job:
    name: octavia-dsvm-noop-base
    parent: octavia-dsvm-base
    vars:
      devstack_localrc:
        DISABLE_AMP_IMAGE_BUILD: True
      devstack_local_conf:
        test-config:
          "$TEMPEST_CONFIG":
            load_balancer:
              test_with_noop: True
        post-config:
          $OCTAVIA_CONF:
            controller_worker:
              amphora_driver: amphora_noop_driver
              compute_driver: compute_noop_driver
              network_driver: network_noop_driver
            certificates:
              cert_manager: local_cert_manager
      devstack_services:
        barbican: false

- job:
    name: octavia-v2-dsvm-noop-api
    parent: octavia-dsvm-noop-base
    vars:
      devstack_local_conf:
        post-config:
          $OCTAVIA_CONF:
            api_settings:
              api_v1_enabled: False
      tempest_concurrency: 2
      tempest_test_regex: ^octavia_tempest_plugin.tests.api.v2
      tox_envlist: all

- job:
    name: octavia-v2-dsvm-noop-py35-api
    parent: octavia-v2-dsvm-noop-api
    vars:
      devstack_localrc:
        USE_PYTHON3: true

- job:
    name: octavia-v2-dsvm-noop-api-stable-rocky
    parent: octavia-v2-dsvm-noop-api
    override-checkout: stable/rocky

- job:
    name: octavia-v2-dsvm-noop-api-stable-queens
    parent: octavia-v2-dsvm-noop-api
    override-checkout: stable/queens

- job:
    name: octavia-v2-dsvm-scenario
    parent: octavia-dsvm-live-base
    vars:
      devstack_local_conf:
        post-config:
          $OCTAVIA_CONF:
            api_settings:
              api_v1_enabled: False
      tempest_concurrency: 2
      tempest_test_regex: ^octavia_tempest_plugin.tests.scenario.v2
      tox_envlist: all

- job:
    name: octavia-v2-dsvm-py35-scenario
    parent: octavia-v2-dsvm-scenario
    vars:
      devstack_localrc:
        USE_PYTHON3: true

- job:
    name: octavia-v2-dsvm-scenario-stable-rocky
    parent: octavia-v2-dsvm-scenario
    override-checkout: stable/rocky

- job:
    name: octavia-v2-dsvm-scenario-stable-queens
    parent: octavia-v2-dsvm-scenario
    override-checkout: stable/queens

- job:
    name: octavia-v2-dsvm-scenario-centos-7
    parent: octavia-v2-dsvm-scenario
    nodeset: devstack-single-node-centos-7
    vars:
      devstack_localrc:
        OCTAVIA_AMP_BASE_OS: centos
        OCTAVIA_AMP_DISTRIBUTION_RELEASE_ID: 7
        OCTAVIA_AMP_IMAGE_SIZE: 3

- job:
    name: octavia-v2-dsvm-scenario-ubuntu-bionic
    parent: octavia-v2-dsvm-scenario
    vars:
      devstack_localrc:
        OCTAVIA_AMP_BASE_OS: ubuntu
        OCTAVIA_AMP_DISTRIBUTION_RELEASE_ID: bionic
