(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{44:function(e,t,n){e.exports=n(74)},49:function(e,t,n){},74:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(14),i=n.n(s),c=(n(49),n(2)),o=n.n(c),l=n(4),u=n(7),d=n(8),p=n(9),h=n(5),m=n(10),v=n(76),f=n(79),g=n(17),b=n(34),E=n(77),y=function(e){var t=e.component,n=e.render,a=e.authed,s=e.to,i=void 0===s?"/login":s,c=Object(g.a)(e,["component","render","authed","to"]);return r.a.createElement(b.a,Object.assign({},c,{render:function(e){return!0===a?t?r.a.createElement(t,e):n():r.a.createElement(E.a,{to:{pathname:i}})}}))},w=function(e){return r.a.createElement("div",Object.assign({},e,{className:"spinner ".concat(e.className||"")}),r.a.createElement("svg",{viewBox:"25 25 50 50"},r.a.createElement("circle",{cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})))},O="/_matrix/maubot/v1";function k(){return{"Content-Type":arguments.length>0&&void 0!==arguments[0]?arguments[0]:"application/json",Authorization:"Bearer ".concat(localStorage.accessToken)}}function N(e,t){return j.apply(this,arguments)}function j(){return(j=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/").concat(t,"/").concat(n),{headers:k(),method:"DELETE"});case 2:if(204!==(a=e.sent).status){e.next=5;break}return e.abrupt("return",{success:!0});case 5:return e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(l.a)(o.a.mark(function e(t,n){var a,r,s=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:void 0,e.next=3,fetch("".concat(O,"/").concat(t,"/").concat(a||n.id),{headers:k(),body:JSON.stringify(n),method:"PUT"});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function C(e){return P.apply(this,arguments)}function P(){return(P=Object(l.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O).concat(t),{headers:k()});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function L(){return(L=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/auth/login"),{method:"POST",body:JSON.stringify({username:t,password:n})});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function A(){return(A=Object(l.a)(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/auth/ping"),{method:"POST",headers:k()});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(n=e.sent).username){e.next=10;break}return e.abrupt("return",n.username);case 10:if("auth_token_missing"!==n.errcode&&"auth_token_invalid"!==n.errcode){e.next=12;break}return e.abrupt("return",null);case 12:throw n;case 13:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function I(){return(I=Object(l.a)(o.a.mark(function e(){var t,n,a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https:"===window.location.protocol?"wss:":"ws:",n="".concat(t,"//").concat(window.location.host).concat(O,"/logs"),a={socket:null,connected:!1,authenticated:!1,fails:-1},r=function(){a.socket.send(localStorage.accessToken),a.connected=!0},s=function(e){var t=JSON.parse(e.data);void 0!==t.auth_success?t.auth_success?(console.info("Websocket connection authentication successful"),a.authenticated=!0,a.fails=-1):console.info("Websocket connection authentication failed"):console.log("SERVLOG",t)},function e(t){t&&(4e3===t.code?console.error("Websocket connection failed: access token invalid or not provided"):1012===t.code&&console.info("Websocket connection closed: server is restarting")),a.connected=!1,a.socket=null,a.fails++;setTimeout(function(){a.socket=new WebSocket(n),a.socket.onopen=r,a.socket.onmessage=s,a.socket.onclose=e},Math.min(5*a.fails*1e3,3e4))}(),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function W(){return(W=Object(l.a)(o.a.mark(function e(t,n){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,fetch("".concat(O,"/plugin/").concat(n),{headers:k("application/zip"),body:t,method:"PUT"});case 3:a=e.sent,e.next=9;break;case 6:return e.next=8,fetch("".concat(O,"/plugins/upload"),{headers:k("application/zip"),body:t,method:"POST"});case 8:a=e.sent;case 9:return e.next=11,a.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function T(){return(T=Object(l.a)(o.a.mark(function e(t,n,a){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/client/").concat(t,"/avatar"),{headers:k(a),body:n,method:"POST"});case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var _={BASE_PATH:O,login:function(e,t){return L.apply(this,arguments)},ping:function(){return A.apply(this,arguments)},openLogSocket:function(){return I.apply(this,arguments)},getInstances:function(){return C("/instances")},getInstance:function(e){return C("/instance/".concat(e))},putInstance:function(e,t){return x("instance",e,t)},deleteInstance:function(e){return N("instance",e)},getPlugins:function(){return C("/plugins")},getPlugin:function(e){return C("/plugin/".concat(e))},uploadPlugin:function(e,t){return W.apply(this,arguments)},deletePlugin:function(e){return N("plugin",e)},getClients:function(){return C("/clients")},getClient:function(e){return C("/clients/".concat(e))},uploadAvatar:function(e,t,n){return T.apply(this,arguments)},getAvatarURL:function(e){return"".concat(O,"/client/").concat(e,"/avatar?access_token=").concat(localStorage.accessToken)},putClient:function(e){return x("client",e)},deleteClient:function(e){return N("client",e)}},D=n(15),V=n(41),F=n(18),M=n(73),H=n(78);function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var R=r.a.createElement("path",{fill:"#000000",d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"});const B=e=>r.a.createElement("svg",U({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),R);n.p;var z=n(42),J=n(75),K=n(35),Z=n.n(K);n(62),n(63);function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var X=r.a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),Y=r.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const Q=e=>r.a.createElement("svg",G({width:24,height:24,viewBox:"0 0 24 24"},e),X,Y);n.p;var $=n(43),q=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).toggle=function(){n.props.onToggle?n.props.onToggle(!n.state.active):n.setState({active:!n.state.active})},n.toggleKeyboard=function(e){return(" "===e.key||"Enter"===e.key)&&n.toggle()},n.state={active:e.active},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({active:e.active})}},{key:"render",value:function(){return r.a.createElement("div",{className:"switch","data-active":this.state.active,onClick:this.toggle,tabIndex:"0",onKeyPress:this.toggleKeyboard,id:this.props.id},r.a.createElement("div",{className:"box"},r.a.createElement("span",{className:"text"},r.a.createElement("span",{className:"on"},this.props.onText||"On"),r.a.createElement("span",{className:"off"},this.props.offText||"Off"))))}}]),t}(a.Component),ee=function(e){var t=e.children,n=e.wrapperClass;return n?r.a.createElement("div",{className:n},r.a.createElement("div",{className:"preference-table"},t)):r.a.createElement("div",{className:"preference-table"},t)},te=function(e){var t=e.name,n=e.fullWidth,a=void 0!==n&&n,s=e.labelFor,i=void 0===s?void 0:s,c=e.children;return r.a.createElement("div",{className:"entry ".concat(a?"full-width":"")},r.a.createElement("label",{htmlFor:i},t),r.a.createElement("div",{className:"value"},c))},ne=function(e){var t=e.rowName,n=e.fullWidth,a=void 0!==n&&n,s=Object(g.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:a,labelFor:t},r.a.createElement("input",Object.assign({},s,{id:t})))},ae=function(e){var t=e.rowName,n=e.fullWidth,a=void 0!==n&&n,s=Object(g.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:a,labelFor:t},r.a.createElement(q,Object.assign({},s,{id:t})))},re=function(e){var t=e.rowName,n=e.fullWidth,a=void 0!==n&&n,s=Object(g.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:a,labelFor:t},r.a.createElement($.a,Object.assign({className:"select"},s,{id:t})))},se=ee,ie=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).delete=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete ".concat(n.state.id,"?"))){e.next=2;break}return e.abrupt("return");case 2:return n.setState({deleting:!0}),e.next=5,n.deleteFunc(n.state.id);case 5:(t=e.sent).success?(n.props.history.push("/"),n.props.onDelete()):n.setState({deleting:!1,error:t.error});case 7:case"end":return e.stop()}},e,this)})),n.inputChange=function(e){e.target.name&&n.setState(Object(D.a)({},e.target.name,e.target.value))},n.renderInstances=function(){return!n.isNew&&r.a.createElement("div",{className:"instances"},r.a.createElement("h3",null,n.hasInstances?"Instances":"No instances :("),n.state.instances.map(function(e){return r.a.createElement(M.a,{className:"instance",key:e.id,to:"/instance/".concat(e.id)},e.id)}))},n.state=Object.assign(n.initialState,e.entry),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object.assign(this.initialState,e.entry))}},{key:"readFile",value:function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var a=new FileReader;a.readAsArrayBuffer(t),a.onload=function(t){return e(t.target.result)},a.onerror=function(e){return n(e)}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"initialState",get:function(){throw Error("Not implemented")}},{key:"hasInstances",get:function(){return this.state.instances&&this.state.instances.length>0}},{key:"isNew",get:function(){return!this.props.entry}}]),t}(a.Component),ce=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).clientSelectEntry=function(e){return e&&{id:e.id,value:e.id,label:r.a.createElement("div",{className:"select-client"},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(e.id),alt:""}),r.a.createElement("span",{className:"displayname"},e.displayname||e.id))}},n.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({saving:!0}),e.next=3,_.putInstance(n.instanceInState,n.props.entry?n.props.entry.id:void 0);case 3:(t=e.sent).id?(n.isNew?n.props.history.push("/instance/".concat(t.id)):(t.id!==n.props.entry.id&&n.props.history.replace("/instance/".concat(t.id)),n.setState({saving:!1,error:""})),n.props.onChange(t)):n.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.deleteFunc=_.deleteInstance,n.updateClientOptions(),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){Object(z.a)(Object(h.a)(t.prototype),"componentWillReceiveProps",this).call(this,e),this.updateClientOptions()}},{key:"updateClientOptions",value:function(){this.clientOptions=Object.values(this.props.ctx.clients).map(this.clientSelectEntry)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"instance"},r.a.createElement(se,null,r.a.createElement(ne,{rowName:"ID",type:"text",name:"id",value:this.state.id,placeholder:"fancybotinstance",onChange:this.inputChange,disabled:!this.isNew,fullWidth:!0,className:"id"}),r.a.createElement(ae,{rowName:"Enabled",active:this.state.enabled,onToggle:function(t){return e.setState({enabled:t})}}),r.a.createElement(ae,{rowName:"Running",active:this.state.started,onToggle:function(t){return e.setState({started:t})}}),r.a.createElement(re,{rowName:"Primary user",options:this.clientOptions,isSearchable:!1,value:this.selectedClientEntry,onChange:function(t){var n=t.id;return e.setState({primary_user:n})}}),r.a.createElement(re,{rowName:"Type",options:this.typeOptions,value:this.selectedPluginEntry,onChange:function(t){var n=t.id;return e.setState({type:n})}})),r.a.createElement(Z.a,{mode:"yaml",theme:"github",onChange:function(t){return e.setState({config:t})},name:"config",value:this.state.config,editorProps:{fontSize:"10pt",$blockScrolling:!0}}),r.a.createElement("div",{className:"buttons"},!this.isNew&&r.a.createElement("button",{className:"delete",onClick:this.delete,disabled:this.loading},this.state.deleting?r.a.createElement(w,null):"Delete"),r.a.createElement("button",{className:"save ".concat(this.isValid?"":"disabled-bg"),onClick:this.save,disabled:this.loading||!this.isValid},this.state.saving?r.a.createElement(w,null):this.isNew?"Create":"Save")),r.a.createElement("div",{className:"error"},this.state.error))}},{key:"initialState",get:function(){return{id:"",primary_user:"",enabled:!0,started:!0,type:"",config:"",saving:!1,deleting:!1,error:""}}},{key:"instanceInState",get:function(){var e=Object.assign({},this.state);return delete e.saving,delete e.deleting,delete e.error,e}},{key:"selectedClientEntry",get:function(){return this.state.primary_user?this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user]):{}}},{key:"selectedPluginEntry",get:function(){return{id:this.state.type,value:this.state.type,label:this.state.type}}},{key:"typeOptions",get:function(){return Object.values(this.props.ctx.plugins).map(function(e){return e&&{id:e.id,value:e.id,label:e.id}})}},{key:"loading",get:function(){return this.state.deleting||this.state.saving}},{key:"isValid",get:function(){return this.state.id&&this.state.primary_user&&this.state.type}}]),t}(ie);ce.ListEntry=function(e){var t=e.entry;return r.a.createElement(J.a,{className:"instance entry",to:"/instance/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement(Q,null))};var oe=Object(H.a)(ce);function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var ue=r.a.createElement("path",{fill:"#000000",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"});const de=e=>r.a.createElement("svg",le({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),ue);n.p;var pe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).avatarUpload=function(){var e=Object(l.a)(o.a.mark(function e(t){var a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.target.files[0],n.setState({uploadingAvatar:!0}),e.next=4,n.readFile(a);case 4:return r=e.sent,e.next=7,_.uploadAvatar(n.state.id,r,a.type);case 7:s=e.sent,n.setState({uploadingAvatar:!1,avatar_url:s.content_uri});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({saving:!0}),e.next=3,_.putClient(n.clientInState);case 3:(t=e.sent).id?(n.isNew?n.props.history.push("/client/".concat(t.id)):n.setState({saving:!1,error:""}),n.props.onChange(t)):n.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.startOrStop=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({startingOrStopping:!0}),e.next=3,_.putClient({id:n.props.entry.id,started:!n.props.entry.started});case 3:(t=e.sent).id?(n.props.onChange(t),n.setState({startingOrStopping:!1,error:""})):n.setState({startingOrStopping:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),n.renderSidebar=function(){return!n.isNew&&r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"avatar-container ".concat(n.state.avatar_url?"":"no-avatar","\n                        ").concat(n.state.uploadingAvatar?"uploading":"")},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(n.state.id),alt:"Avatar"}),r.a.createElement(de,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"image/png, image/jpeg",onChange:n.avatarUpload,disabled:n.state.uploadingAvatar,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),n.state.uploadingAvatar&&r.a.createElement(w,null)),r.a.createElement("div",{className:"started-container"},r.a.createElement("span",{className:"started ".concat(n.props.entry.started,"\n                        ").concat(n.props.entry.enabled?"":"disabled")}),r.a.createElement("span",{className:"text"},n.props.entry.started?"Started":n.props.entry.enabled?"Stopped":"Disabled")),(n.props.entry.started||n.props.entry.enabled)&&r.a.createElement("button",{className:"save",onClick:n.startOrStop,disabled:n.loading},n.state.startingOrStopping?r.a.createElement(w,null):n.props.entry.started?"Stop":"Start"))},n.renderPreferences=function(){return r.a.createElement(ee,null,r.a.createElement(ne,{rowName:"User ID",type:"text",disabled:!n.isNew,fullWidth:!0,name:n.isNew?"":"id",value:n.state.id,className:"id",placeholder:"@fancybot:example.com",onChange:n.inputChange}),r.a.createElement(ne,{rowName:"Homeserver",type:"text",name:"homeserver",value:n.state.homeserver,placeholder:"https://example.com",onChange:n.inputChange}),r.a.createElement(ne,{rowName:"Access token",type:"text",name:"access_token",value:n.state.access_token,onChange:n.inputChange,placeholder:"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc"}),r.a.createElement(ne,{rowName:"Display name",type:"text",name:"displayname",value:n.state.displayname,placeholder:"My fancy bot",onChange:n.inputChange}),r.a.createElement(ne,{rowName:"Avatar URL",type:"text",name:"avatar_url",value:n.state.avatar_url,onChange:n.inputChange,placeholder:"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko"}),r.a.createElement(ae,{rowName:"Sync",active:n.state.sync,onToggle:function(e){return n.setState({sync:e})}}),r.a.createElement(ae,{rowName:"Autojoin",active:n.state.autojoin,onToggle:function(e){return n.setState({autojoin:e})}}),r.a.createElement(ae,{rowName:"Enabled",active:n.state.enabled,onToggle:function(e){return n.setState({enabled:e,started:e&&n.state.started})}}))},n.renderPrefButtons=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"buttons"},!n.isNew&&r.a.createElement("button",{className:"delete ".concat(n.hasInstances?"disabled-bg":""),onClick:n.delete,disabled:n.loading||n.hasInstances,title:n.hasInstances?"Can't delete client that is in use":""},n.state.deleting?r.a.createElement(w,null):"Delete"),r.a.createElement("button",{className:"save",onClick:n.save,disabled:n.loading},n.state.saving?r.a.createElement(w,null):n.isNew?"Create":"Save")),r.a.createElement("div",{className:"error"},n.state.error))},n.deleteFunc=_.deleteClient,n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"client"},this.renderSidebar(),r.a.createElement("div",{className:"info"},this.renderPreferences(),this.renderPrefButtons(),this.renderInstances()))}},{key:"initialState",get:function(){return{id:"",displayname:"",homeserver:"",avatar_url:"",access_token:"",sync:!0,autojoin:!0,enabled:!0,started:!1,instances:[],uploadingAvatar:!1,saving:!1,deleting:!1,startingOrStopping:!1,error:""}}},{key:"clientInState",get:function(){var e=Object.assign({},this.state);return delete e.uploadingAvatar,delete e.saving,delete e.deleting,delete e.startingOrStopping,delete e.error,delete e.instances,e}},{key:"loading",get:function(){return this.state.saving||this.state.startingOrStopping||this.state.deleting}}]),t}(ie);pe.ListEntry=function(e){var t=e.entry,n=["client","entry"];return t.enabled?t.started||n.push("stopped"):n.push("disabled"),r.a.createElement(J.a,{className:n.join(" "),to:"/client/".concat(t.id)},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(t.id),alt:""}),r.a.createElement("span",{className:"displayname"},t.displayname||t.id),r.a.createElement(Q,null))};var he=Object(H.a)(pe),me=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).upload=function(){var e=Object(l.a)(o.a.mark(function e(t){var a,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.target.files[0],n.setState({uploadingAvatar:!0}),e.next=4,n.readFile(a);case 4:return r=e.sent,e.next=7,_.uploadPlugin(r,n.state.id);case 7:(s=e.sent).id?(n.isNew?n.props.history.push("/plugin/".concat(s.id)):n.setState({saving:!1,error:""}),n.props.onChange(s)):n.setState({saving:!1,error:s.error});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"plugin"},!this.isNew&&r.a.createElement(se,null,r.a.createElement(ne,{rowName:"ID",type:"text",value:this.state.id,disabled:!0,className:"id"}),r.a.createElement(ne,{rowName:"Version",type:"text",value:this.state.version,disabled:!0})),r.a.createElement("div",{className:"upload-box ".concat(this.state.uploading?"uploading":"")},r.a.createElement(de,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"application/zip",onChange:this.upload,disabled:this.state.uploading||this.state.deleting,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),this.state.uploading&&r.a.createElement(w,null)),!this.isNew&&r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{className:"delete ".concat(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete plugin that is in use":""},this.state.deleting?r.a.createElement(w,null):"Delete")),r.a.createElement("div",{className:"error"},this.state.error),!this.isNew&&this.renderInstances())}},{key:"initialState",get:function(){return{id:"",version:"",instances:[],uploading:!1,deleting:!1,error:""}}}]),t}(ie);me.ListEntry=function(e){var t=e.entry;return r.a.createElement(J.a,{className:"plugin entry",to:"/plugin/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement(Q,null))};var ve=me,fe=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).renderNotFound=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"path";return r.a.createElement("div",{className:"not-found"},"Oops! I'm afraid that ",e," couldn't be found.")},n.state={instances:{},clients:{},plugins:{},sidebarOpen:!1},window.maubot=Object(F.a)(Object(F.a)(n)),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&this.setState({sidebarOpen:!1})}},{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t,n,a,r,s,i,c,l,u,d,p,h,m,v,f,g,b,E,y,w,O,k,N,j,x,S,C;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([_.getInstances(),_.getClients(),_.getPlugins()]);case 2:for(t=e.sent,n=Object(V.a)(t,3),a=n[0],r=n[1],s=n[2],i={},c=!0,l=!1,u=void 0,e.prev=11,d=a[Symbol.iterator]();!(c=(p=d.next()).done);c=!0)h=p.value,i[h.id]=h;e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),l=!0,u=e.t0;case 19:e.prev=19,e.prev=20,c||null==d.return||d.return();case 22:if(e.prev=22,!l){e.next=25;break}throw u;case 25:return e.finish(22);case 26:return e.finish(19);case 27:for(m={},v=!0,f=!1,g=void 0,e.prev=31,b=r[Symbol.iterator]();!(v=(E=b.next()).done);v=!0)y=E.value,m[y.id]=y;e.next=39;break;case 35:e.prev=35,e.t1=e.catch(31),f=!0,g=e.t1;case 39:e.prev=39,e.prev=40,v||null==b.return||b.return();case 42:if(e.prev=42,!f){e.next=45;break}throw g;case 45:return e.finish(42);case 46:return e.finish(39);case 47:for(w={},O=!0,k=!1,N=void 0,e.prev=51,j=s[Symbol.iterator]();!(O=(x=j.next()).done);O=!0)S=x.value,w[S.id]=S;e.next=59;break;case 55:e.prev=55,e.t2=e.catch(51),k=!0,N=e.t2;case 59:e.prev=59,e.prev=60,O||null==j.return||j.return();case 62:if(e.prev=62,!k){e.next=65;break}throw N;case 65:return e.finish(62);case 66:return e.finish(59);case 67:return this.setState({instances:i,clients:m,plugins:w}),e.next=70,_.openLogSocket();case 70:C=e.sent,console.log("WebSocket opened:",C),window.logs=C;case 73:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26],[31,35,39,47],[40,,42,46],[51,55,59,67],[60,,62,66]])}));return function(){return e.apply(this,arguments)}}()},{key:"renderList",value:function(e,t){return this.state[e]&&Object.values(this.state[e]).map(function(e){return r.a.createElement(t,{key:e.id,entry:e})})}},{key:"delete",value:function(e,t){var n=Object.assign({},this.state[e]);delete n[t],this.setState(Object(D.a)({},e,n))}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=Object.assign({},this.state[e]);n&&n!==t.id&&delete a[n],a[t.id]=t,this.setState(Object(D.a)({},e,a))}},{key:"renderView",value:function(e,t,n){var a=this,s=this.state[e][n];return s?r.a.createElement(t,{entry:s,onDelete:function(){return a.delete(e,n)},onChange:function(t){return a.add(e,t,n)},ctx:this.state}):this.renderNotFound(e.slice(0,-1))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"dashboard ".concat(this.state.sidebarOpen?"sidebar-open":"")},r.a.createElement(M.a,{to:"/",className:"title"},r.a.createElement("img",{src:"/favicon.png",alt:""}),"Maubot Manager"),r.a.createElement("div",{className:"user"},r.a.createElement("span",null,localStorage.username)),r.a.createElement("nav",{className:"sidebar"},r.a.createElement("div",{className:"instances list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Instances"),r.a.createElement(M.a,{to:"/new/instance"},r.a.createElement(B,null))),this.renderList("instances",oe.ListEntry)),r.a.createElement("div",{className:"clients list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Clients"),r.a.createElement(M.a,{to:"/new/client"},r.a.createElement(B,null))),this.renderList("clients",he.ListEntry)),r.a.createElement("div",{className:"plugins list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Plugins"),r.a.createElement(M.a,{to:"/new/plugin"},r.a.createElement(B,null))),this.renderList("plugins",ve.ListEntry))),r.a.createElement("div",{className:"topbar"},r.a.createElement("div",{className:"hamburger ".concat(this.state.sidebarOpen?"active":""),onClick:function(t){return e.setState({sidebarOpen:!e.state.sidebarOpen})}},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null))),r.a.createElement("main",{className:"view"},r.a.createElement(f.a,null,r.a.createElement(b.a,{path:"/",exact:!0,render:function(){return"Hello, World!"}}),r.a.createElement(b.a,{path:"/new/instance",render:function(){return r.a.createElement(oe,{onChange:function(t){return e.add("instances",t)},ctx:e.state})}}),r.a.createElement(b.a,{path:"/new/client",render:function(){return r.a.createElement(he,{onChange:function(t){return e.add("clients",t)}})}}),r.a.createElement(b.a,{path:"/new/plugin",render:function(){return r.a.createElement(ve,{onChange:function(t){return e.add("plugins",t)}})}}),r.a.createElement(b.a,{path:"/instance/:id",render:function(t){var n=t.match;return e.renderView("instances",oe,n.params.id)}}),r.a.createElement(b.a,{path:"/client/:id",render:function(t){var n=t.match;return e.renderView("clients",he,n.params.id)}}),r.a.createElement(b.a,{path:"/plugin/:id",render:function(t){var n=t.match;return e.renderView("plugins",ve,n.params.id)}}),r.a.createElement(b.a,{render:function(){return e.renderNotFound()}}))))}}]),t}(a.Component),ge=Object(H.a)(fe),be=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e,n))).inputChanged=function(e){return a.setState(Object(D.a)({},e.target.name,e.target.value))},a.login=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loading:!0}),e.next=3,_.login(a.state.username,a.state.password);case 3:if(!(t=e.sent).token){e.next=9;break}return e.next=7,a.props.onLogin(t.token);case 7:e.next=10;break;case 9:t.error?a.setState({error:t.error,loading:!1}):(a.setState({error:"Unknown error",loading:!1}),console.log("Unknown error:",t));case 10:case"end":return e.stop()}},e,this)})),a.state={username:"",password:"",loading:!1,error:""},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"login-wrapper"},r.a.createElement("div",{className:"login ".concat(this.state.error&&"errored")},r.a.createElement("h1",null,"Maubot Manager"),r.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,name:"username",onChange:this.inputChanged}),r.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,name:"password",onChange:this.inputChanged}),r.a.createElement("button",{onClick:this.login},this.state.loading?r.a.createElement(w,null):"Log in"),this.state.error&&r.a.createElement("div",{className:"error"},this.state.error)))}}]),t}(a.Component),Ee=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).login=function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.accessToken=t,e.next=3,n.ping();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.state={pinged:!1,authed:!1},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!localStorage.accessToken){e.next=3;break}return e.next=3,this.ping();case 3:this.setState({pinged:!0});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ping",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.ping();case 3:(t=e.sent)?(localStorage.username=t,this.setState({authed:!0})):delete localStorage.accessToken,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.pinged?r.a.createElement(v.a,null,r.a.createElement("div",{className:"maubot-wrapper ".concat(this.state.authed?"authenticated":"")},r.a.createElement(f.a,null,r.a.createElement(y,{path:"/login",render:function(){return r.a.createElement(be,{onLogin:e.login})},authed:!this.state.authed,to:"/"}),r.a.createElement(y,{path:"/",component:ge,authed:this.state.authed})))):r.a.createElement(w,{className:"maubot-loading"})}}]),t}(a.Component);i.a.render(r.a.createElement(Ee,null),document.getElementById("root"))}},[[44,2,1]]]);
//# sourceMappingURL=main.c6ac9c52.chunk.js.map